:root { --line:#1f2937 }
html,body{height:100%;margin:0;background:#0b1220;color:#e5e7eb;font:14px/1.4 ui-sans-serif,system-ui,Segoe UI,Roboto}
.topbar{display:flex;gap:.5rem;align-items:center;padding:.6rem .8rem;border-bottom:1px solid #0f172a;position:sticky;top:0;background:#0b1220}
.btn{background:#111827;border:1px solid #1f2937;color:#e5e7eb;padding:.45rem .7rem;border-radius:.6rem;cursor:pointer}
.btn.primary{background:#047857;border-color:#059669}
.btn.small{font-size:12px;padding:.25rem .5rem}
.btn.danger{background:#7f1d1d;border-color:#991b1b}
.btn.chip{background:#e5e7eb;color:#111827;border-color:#e5e7eb}
.vlist{display:flex;flex-direction:column;gap:.6rem}
.grid{display:grid;grid-template-columns:300px 1fr}
.sidebar{border-right:1px solid #0f172a;background:#0b1220}
.panel{padding:1rem}
.section{padding:1rem;border-bottom:1px solid #0f172a}
.section h3{margin:.2rem 0 .6rem;font-size:13px;color:#9ca3af;letter-spacing:.08em;text-transform:uppercase}
.row{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
.field{display:flex;flex-direction:column;gap:.25rem;margin:.4rem 0}
.input, select, textarea{background:#0b1220;border:1px solid #1f2937;color:#e5e7eb;padding:.45rem .55rem;border-radius:.5rem}
textarea{min-height:96px;resize:vertical}
.tabs{display:flex;gap:.5rem;padding:.5rem;border-bottom:1px solid #0f172a;margin-bottom:.8rem}
.tab{padding:.5rem .9rem;border-radius:.7rem;border:1px solid #e5e7eb;background:#e5e7eb;color:#111827;cursor:pointer}
.tab:hover{filter:brightness(0.95)}
.tab:focus-visible{outline:2px solid #93c5fd; outline-offset:2px}
.tab.active{background:#047857;color:#fff;border-color:#059669}
.toolbar{display:flex;gap:.5rem;align-items:center;margin:.25rem 0 .75rem}
.toolbar .input{width:110px}

.vrow{display:grid;gap:.75rem;border:1px solid var(--line);border-radius:.6rem;padding:.6rem;
      grid-template-columns:64px 120px 160px 220px 220px 220px 1fr}
.vrow.selected{outline:2px solid #e5e7eb}
.selcell{display:flex;gap:.25rem;align-items:center;justify-content:center}
.time{font-variant-numeric:tabular-nums;align-self:center}
.param{display:flex;gap:.4rem;align-items:center;min-width:0}
.param label{white-space:nowrap}
.param .input, .param select, .param textarea{flex:1 1 auto; width:100%; min-width:0}

.mattable{width:100%;border-collapse:collapse;margin-top:.5rem}
.mattable th,.mattable td{border:1px solid #1f2937;padding:.3rem .4rem}

.gantt-header,.gantt-row{display:grid;grid-template-columns:220px 1fr;gap:.5rem;align-items:stretch;margin:.2rem 0}
.gantt-hours{display:grid;grid-template-columns:repeat(24,1fr);gap:0}
.gantt-hours div{border-left:1px solid #1f2937;padding:.2rem 0;text-align:center;font-variant-numeric:tabular-nums}
.gantt-track{position:relative;border:1px solid #1f2937;height:40px;border-radius:.4rem;overflow:hidden}
.seg{position:absolute;height:100%;border-radius:.2rem}
.meta{position:absolute;bottom:2px;left:4px;font-size:12px;color:#111827;background:rgba(229,231,235,.8);padding:1px 4px;border-radius:3px}

@media (max-width:1200px){
  .vrow{grid-template-columns:64px 120px 1fr 1fr}
}

textarea.notes{min-height:140px;overflow:hidden;resize:vertical;line-height:1.35}
.param textarea.notes{flex:1 1 auto;width:100%}
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none;margin:0 }

/* === Notas a ancho completo === */
.notes-cell{grid-column:1 / -1}
textarea.notes{min-height:140px;overflow:hidden;resize:vertical;line-height:1.35;width:100%}
.param textarea.notes{flex:1 1 auto;width:100%}
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none;margin:0 }

/* === Lista STAFF === */
.stafflist{display:flex;flex-wrap:wrap;gap:.35rem;margin-top:.5rem}
.staffchip{display:flex;align-items:center;gap:.35rem;background:#0f172a;border:1px solid #1f2937;color:#e5e7eb;border-radius:.6rem;padding:.25rem .5rem}
.staffchip .del{background:#7f1d1d;border:1px solid #991b1b;color:#fff;border-radius:.45rem;padding:.1rem .35rem;cursor:pointer}

/* === Sub-vistas Gantt y tarjetas === */
.subtabs{display:flex;gap:.35rem;margin:0 0 .6rem 0}
.subtab{padding:.35rem .6rem;border-radius:.5rem;border:1px solid #1f2937;background:#0b1220;color:#e5e7eb;cursor:pointer}
.subtab.active{background:#2563eb;color:#fff;border-color:#3b82f6}
.cardlist{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:.75rem}
.card{border:1px solid #1f2937;border-radius:.6rem;padding:.6rem;background:#0b1220}
.card h4{margin:.1rem 0 .4rem}
.card .item{display:flex;justify-content:space-between;border-bottom:1px dashed #1f2937;padding:.25rem 0}
@media print{
  .topbar,.sidebar,.tabs,.toolbar,.subtabs,.btn{display:none !important}
  body{background:#fff;color:#000}
  .card{background:#fff;border-color:#000;break-inside:avoid}
}

/* === Patch: Notas mitad ancho/altura + tabla materiales === */
.vrow{display:flex;flex-wrap:wrap;gap:.75rem;align-items:flex-start}
.vrow .param{flex:0 0 auto}
.vrow .notes-cell{grid-column:1 / span 3}
textarea.notes{min-height:70px}
table.matlist{width:100%;border-collapse:collapse;margin-top:.35rem}
table.matlist th,table.matlist td{border-bottom:1px solid #1f2937;padding:.25rem .35rem;text-align:left}
table.matlist td.qty{width:90px}
table.matlist td.act{width:120px}
table.matlist .iconbtn{padding:.15rem .4rem;border:1px solid #1f2937;border-radius:.35rem;background:#0b1220;color:#e5e7eb;cursor:pointer;margin-right:.25rem}
table.matlist .iconbtn:hover{filter:brightness(1.15)}

/* === Tarjeta apilada === */
.card .vitem{display:block;border-bottom:1px dashed #1f2937;padding:.45rem 0}
.card .vitem:last-child{border-bottom:none}
.card .line{margin:.08rem 0}
.card .time{font-weight:600}
.card .muted{opacity:.9}

/* === Grid estable de filas (Transporte + materiales/notas fijas) === */
.vrow{
  display:grid;
  grid-template-columns: auto 160px 1fr 1fr 1fr 1.6fr; /* # | hora/dur | tarea | loc/dest | veh | materiales */
  gap:.75rem;
  align-items:center;
}
.vrow .selcell{grid-column:1}
.vrow .time{grid-column:2}
.vrow .cell-task{grid-column:3}
.vrow .cell-loc{grid-column:4}
.vrow .cell-veh{grid-column:5}
.vrow .cell-mat{grid-column:6}
.vrow .mat-table{grid-column:4 / span 3}
.vrow .notes-cell{grid-column:1 / span 3}
.vrow .hint{grid-column:2 / span 2; font-size:.85rem; opacity:.85}
.lock-chip{display:inline-flex;gap:.4rem;align-items:center;background:#0f172a;border:1px solid #1f2937;color:#e5e7eb;border-radius:.5rem;padding:.2rem .5rem}
.lock-chip .ico{opacity:.7}
.err{outline:1px solid #b91c1c; border-color:#b91c1c}

/* Notas 50% y tabla materiales coherente */
textarea.notes{min-height:70px}
table.matlist{width:100%;border-collapse:collapse;margin-top:.35rem}
table.matlist th,table.matlist td{border-bottom:1px solid #1f2937;padding:.25rem .35rem;text-align:left}
table.matlist td.qty{width:90px}
table.matlist td.act{width:120px}
table.matlist .iconbtn{padding:.15rem .4rem;border:1px solid #1f2937;border-radius:.35rem;background:#0b1220;color:#e5e7eb;cursor:pointer;margin-right:.25rem}
table.matlist .iconbtn:hover{filter:brightness(1.15)}

/* === Patch EP: vrow grid estable y flechas tiempo === */
.vrow{
  display:grid;
  grid-template-columns: auto 160px 1fr 1fr 1fr 1.6fr;
  gap:.75rem;
  align-items:center;
}
.vrow .selcell{grid-column:1}
.vrow .time{grid-column:2}
.vrow .cell-task{grid-column:3}
.vrow .cell-loc{grid-column:4}
.vrow .cell-veh{grid-column:5}
.vrow .cell-mat{grid-column:6}
.vrow .notes-cell{grid-column:1 / -1}
.time-adjust{display:inline-flex; gap:.25rem; margin-left:.35rem}
.time-adjust .btn{padding:.2rem .45rem}
@media (max-width:900px){
  .vrow{grid-template-columns:auto 140px 1fr 1fr}
  .vrow .cell-veh{grid-column:3}
  .vrow .cell-mat{grid-column:4}
  .vrow .notes-cell{grid-column:1 / -1}
}
/* === Fin Patch EP === */

/* === EP PATCH: layout vrow estable === */
.vrow{display:grid;gap:.75rem;border:1px solid var(--line);border-radius:.6rem;padding:.6rem;
      grid-template-columns:64px 140px 180px 1fr 1fr 1fr 1.6fr}
.vrow .notes-cell{grid-column:1 / -1}
.time-adjust{display:inline-flex;gap:.25rem;margin-left:.35rem}
.time-adjust .btn{padding:.2rem .45rem}
@media (max-width:1200px){
  .vrow{grid-template-columns:64px 120px 160px 1fr 1fr}
  .vrow .notes-cell{grid-column:1 / -1}
}
/* === fin patch === */

/* === EP PATCH 2025: Layout filas horario === */
.vrow{
  display:grid;
  gap:.75rem;
  border:1px solid var(--line);
  border-radius:.6rem;
  padding:.75rem;
  grid-template-columns:64px 170px 160px 1fr 1fr 1fr 1.5fr;
  align-items:start;
}
.vrow .selcell{
  grid-column:1;
  display:flex;
  flex-direction:column;
  gap:.35rem;
  align-items:center;
}
.vrow .time{
  grid-column:2;
  display:flex;
  align-items:center;
  gap:.45rem;
}
.time-label{
  font-variant-numeric:tabular-nums;
  font-weight:600;
}
.time-shift{
  display:flex;
  flex-direction:column;
  gap:.25rem;
}
.time-shift .btn{
  padding:.15rem .4rem;
  line-height:1;
}
.duration-cell{grid-column:3;}
.task-cell{grid-column:4;}
.location-cell{grid-column:5;}
.vehicle-cell{grid-column:6;}
.materials-cell{grid-column:7;}
.notes-cell{grid-column:1 / -1;}
@media (max-width:1200px){
  .vrow{
    grid-template-columns:64px 150px 1fr 1fr;
  }
  .duration-cell{grid-column:3;}
  .task-cell{grid-column:4;}
  .location-cell{grid-column:3;}
  .vehicle-cell{grid-column:4;}
  .materials-cell{grid-column:1 / -1;}
}
@media (max-width:900px){
  .vrow{
    grid-template-columns:64px 1fr;
  }
  .vrow .time{grid-column:1 / -1;}
  .duration-cell,
  .task-cell,
  .location-cell,
  .vehicle-cell,
  .materials-cell{
    grid-column:1 / -1;
  }
}
/* === Fin EP PATCH 2025 === */
